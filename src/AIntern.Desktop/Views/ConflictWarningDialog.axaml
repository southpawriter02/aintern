<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:AIntern.Desktop.ViewModels"
        mc:Ignorable="d"
        x:Class="AIntern.Desktop.Views.ConflictWarningDialog"
        x:DataType="vm:ConflictWarningDialogViewModel"
        Title="File Conflict Detected"
        Width="520"
        Height="400"
        MinWidth="400"
        MinHeight="300"
        WindowStartupLocation="CenterOwner"
        CanResize="False"
        ShowInTaskbar="False">

    <!-- Keyboard Shortcuts -->
    <Window.KeyBindings>
        <KeyBinding Gesture="Escape" Command="{Binding CancelCommand}" />
        <KeyBinding Gesture="Enter" Command="{Binding RefreshDiffCommand}" />
    </Window.KeyBindings>

    <Grid RowDefinitions="Auto, *, Auto" Margin="24">

        <!-- Header Section -->
        <StackPanel Grid.Row="0"
                    Spacing="12"
                    HorizontalAlignment="Center"
                    Margin="0,0,0,16">

            <!-- Warning Icon -->
            <Border Background="#33F59E0B"
                    CornerRadius="24"
                    Width="64"
                    Height="64"
                    HorizontalAlignment="Center">
                <TextBlock Text="âš "
                           FontSize="32"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           Foreground="#F59E0B" />
            </Border>

            <!-- Title -->
            <TextBlock Text="File Conflict Detected"
                       FontSize="20"
                       FontWeight="SemiBold"
                       HorizontalAlignment="Center" />
        </StackPanel>

        <!-- Content Section -->
        <StackPanel Grid.Row="1" Spacing="16">

            <!-- Conflict Message -->
            <TextBlock Text="{Binding ConflictMessage}"
                       TextWrapping="Wrap"
                       TextAlignment="Center"
                       FontSize="14"
                       Opacity="0.8"
                       LineHeight="22" />

            <!-- Conflict Explanation -->
            <TextBlock Text="{Binding ConflictExplanation}"
                       TextWrapping="Wrap"
                       TextAlignment="Center"
                       FontSize="13"
                       Opacity="0.6"
                       LineHeight="20"
                       Margin="0,0,0,8" />

            <!-- File Information Card -->
            <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                    BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="16">
                <Grid RowDefinitions="Auto, Auto, Auto, Auto" ColumnDefinitions="Auto, *">

                    <!-- File Label -->
                    <TextBlock Grid.Row="0" Grid.Column="0"
                               Text="File:"
                               FontWeight="SemiBold"
                               Opacity="0.7"
                               FontSize="12"
                               Margin="0,0,12,4" />

                    <!-- File Path -->
                    <TextBlock Grid.Row="0" Grid.Column="1"
                               Text="{Binding FilePath}"
                               FontFamily="Consolas, Monaco, monospace"
                               FontSize="12"
                               TextTrimming="CharacterEllipsis"
                               ToolTip.Tip="{Binding FilePath}"
                               Margin="0,0,0,4" />

                    <!-- Last Modified Label -->
                    <TextBlock Grid.Row="1" Grid.Column="0"
                               Text="Modified:"
                               FontWeight="SemiBold"
                               Opacity="0.7"
                               FontSize="12"
                               Margin="0,8,12,4" />

                    <!-- Last Modified Value -->
                    <TextBlock Grid.Row="1" Grid.Column="1"
                               Text="{Binding LastModified, StringFormat='{}{0:g}'}"
                               FontSize="12"
                               Margin="0,8,0,4" />

                    <!-- Snapshot Label -->
                    <TextBlock Grid.Row="2" Grid.Column="0"
                               Text="Snapshot:"
                               FontWeight="SemiBold"
                               Opacity="0.7"
                               FontSize="12"
                               Margin="0,4,12,4" />

                    <!-- Snapshot Value -->
                    <TextBlock Grid.Row="2" Grid.Column="1"
                               Text="{Binding SnapshotTime, StringFormat='{}{0:g}'}"
                               FontSize="12"
                               Margin="0,4,0,4" />

                    <!-- Time Since Snapshot -->
                    <TextBlock Grid.Row="3" Grid.Column="1"
                               Text="{Binding TimeSinceSnapshotText, StringFormat='({0})'}"
                               FontSize="11"
                               Opacity="0.6"
                               FontStyle="Italic"
                               Margin="0,2,0,0" />
                </Grid>
            </Border>
        </StackPanel>

        <!-- Actions Section -->
        <StackPanel Grid.Row="2"
                    Orientation="Horizontal"
                    HorizontalAlignment="Center"
                    Spacing="12"
                    Margin="0,24,0,0">

            <!-- Refresh Diff Button (Recommended) -->
            <Button Command="{Binding RefreshDiffCommand}"
                    MinWidth="120"
                    Classes="accent"
                    ToolTip.Tip="Recompute diff against current file content (Recommended)">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="ðŸ”„" FontSize="14" />
                    <TextBlock Text="Refresh Diff" />
                </StackPanel>
            </Button>

            <!-- Force Apply Button (Warning) -->
            <Button Command="{Binding ForceApplyCommand}"
                    MinWidth="110"
                    Background="#33F59E0B"
                    Foreground="#F59E0B"
                    ToolTip.Tip="Overwrite file with proposed changes (may lose recent edits)">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="âš " FontSize="14" />
                    <TextBlock Text="Force Apply" />
                </StackPanel>
            </Button>

            <!-- Cancel Button -->
            <Button Content="Cancel"
                    Command="{Binding CancelCommand}"
                    MinWidth="80"
                    ToolTip.Tip="Cancel without making changes" />
        </StackPanel>
    </Grid>
</Window>

# v0.5.5d - Keyboard Shortcuts System

**Released:** 2026-01-18

## Summary
Comprehensive keyboard shortcut system for the integrated terminal with a registry, mapping, customization, PTY pass-through support, and conflict detection.

## Features

### TerminalShortcutAction Enum
35+ categorized terminal actions:
- **Terminal Panel**: Toggle, new/close, tab switching (1-9), maximize
- **Terminal Input**: PTY pass-through (Ctrl+C, Ctrl+Z, Ctrl+D, line editing)
- **Terminal Search**: Open/close, navigation, toggle options
- **Terminal Selection**: Copy, paste, select all (Ctrl+Shift to avoid PTY conflicts)
- **Terminal Scroll**: Page/line scrolling, top/bottom navigation
- **Command Blocks**: Execute, send to terminal

### KeyBinding Model
Platform-independent key binding with:
- `Key` (string) + `Modifiers` (KeyModifierFlags)
- Platform-aware display formatting (âŒ˜ on macOS, Ctrl on Windows/Linux)
- Serialization for persistence (`Ctrl+Shift+C` format)
- Parse/format methods for settings

### ITerminalShortcutService Interface
Complete binding management:
- `GetAllBindings()` / `GetBindingsByCategory()` / `GetCategories()`
- `TryGetAction()` for key event handling
- `UpdateBinding()` / `ResetBinding()` / `ResetAllBindings()`
- `HasConflict()` / `GetConflictingBinding()` for conflict detection
- `BindingsChanged` event for UI updates

### TerminalShortcutService Implementation
- 35+ default bindings across 6 categories
- Custom binding persistence via `AppSettings.CustomKeyBindings`
- PTY pass-through flag for shell shortcuts
- Conflict detection and resolution

## Files Changed

### New Files
| File | Description |
|------|-------------|
| `src/AIntern.Core/Models/Terminal/TerminalShortcutAction.cs` | 35+ categorized terminal actions |
| `src/AIntern.Core/Models/Terminal/KeyBinding.cs` | Key binding model with formatting |
| `src/AIntern.Core/Interfaces/ITerminalShortcutService.cs` | Service interface |
| `src/AIntern.Services/TerminalShortcutService.cs` | Service implementation |
| `tests/AIntern.Core.Tests/Models/Terminal/KeyBindingTests.cs` | 26 unit tests |
| `tests/AIntern.Services.Tests/TerminalShortcutServiceTests.cs` | 32 unit tests |

### Modified Files
| File | Description |
|------|-------------|
| `src/AIntern.Core/Models/AppSettings.cs` | Added `CustomKeyBindings` dictionary |
| `src/AIntern.Services/Terminal/TerminalServiceExtensions.cs` | DI registration |

## Default Shortcuts Reference

| Shortcut | Action | Category |
|----------|--------|----------|
| Ctrl+` | Toggle Terminal | Terminal Panel |
| Ctrl+Shift+` | New Terminal | Terminal Panel |
| Ctrl+Shift+W | Close Terminal | Terminal Panel |
| Ctrl+1-9 | Switch to Terminal N | Terminal Panel |
| Ctrl+C | SIGINT (PTY) | Terminal Input |
| Ctrl+Z | SIGTSTP (PTY) | Terminal Input |
| Ctrl+D | EOF (PTY) | Terminal Input |
| Ctrl+F | Open Search | Terminal Search |
| F3 / Shift+F3 | Next/Previous Result | Terminal Search |
| Ctrl+Shift+C | Copy | Terminal Selection |
| Ctrl+Shift+V | Paste | Terminal Selection |
| Shift+PageUp/Down | Scroll Page | Terminal Scroll |

## Test Coverage
- **KeyBindingTests**: 26 tests (display, parsing, matching, equality)
- **TerminalShortcutServiceTests**: 32 tests (bindings, lookup, customization, conflicts)
- **Total**: 58 passing tests

## Technical Notes

### Platform Independence
The `KeyModifierFlags` enum and string-based key names in Core avoid Avalonia dependencies, enabling future platform-specific adapters.

### PTY Pass-Through
Shell shortcuts (Ctrl+C, Ctrl+Z, etc.) have `PassToPty = true`, indicating they should be forwarded to the PTY rather than handled by the application.

### Naming Convention
Renamed from `IKeyboardShortcutService` to `ITerminalShortcutService` to avoid conflict with existing Desktop layer service (v0.4.5f).

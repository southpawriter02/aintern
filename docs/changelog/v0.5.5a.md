# v0.5.5a - Terminal Search Models

**Released**: 2026-01-18
**Parent**: v0.5.5 Polish & Integration

## Summary

Implementation of data models for terminal search functionality, enabling efficient text search within the terminal buffer with support for navigation, highlighting, and visual customization.

## New Components

### Core Models

| File | Description |
|------|-------------|
| `TerminalSearchResult.cs` | Represents a single search match with position info, context extraction, and preview generation |
| `TerminalSearchState.cs` | Immutable record maintaining search state with navigation methods and computed properties |
| `TerminalSearchOptions.cs` | Configuration for search behavior with presets (Default, LargeBuffer, QuickFind, RegexFocused) |
| `SearchHighlightStyle.cs` | Visual styling with theme presets (Default, Dark, Light, HighContrast, Solarized) |
| `SearchDirection.cs` | Enum for search direction (Forward/Backward) with extension methods |
| `TerminalSearchExtensions.cs` | Extension methods for visibility filtering, line indexing, and position calculations |

## Key Features

### TerminalSearchResult
- Position tracking (LineIndex, StartColumn, Length, EndColumn)
- Context extraction (GetContextBefore, GetContextAfter)
- Preview generation (ToPreviewString, ToCompactPreview)
- Overlap and position comparison methods
- Factory methods for creation from regex matches

### TerminalSearchState (Immutable Record)
- Query and option properties (CaseSensitive, UseRegex, WrapAround, IncludeScrollback)
- Results collection with navigation state
- Computed properties: HasResults, HasQuery, HasError, ResultsSummary, CanNavigateNext/Previous
- Navigation methods: NavigateNext, NavigatePrevious, NavigateToIndex, NavigateToFirst/Last
- Factory methods: Empty, ForQuery, Searching, WithResults, WithError
- Toggle methods for options (ToggleCaseSensitive, ToggleRegex, ToggleWrapAround)

### TerminalSearchOptions
- Result limiting (MaxResults)
- Timing configuration (DebounceDelayMs, RegexTimeoutMs)
- Default search settings
- Presets: Default, LargeBuffer (50K results, 300ms debounce), QuickFind (1K results, 50ms debounce), RegexFocused

### SearchHighlightStyle
- Match and current match colors (background, foreground, border)
- Opacity and styling options (outline, underline, bold)
- Theme presets: Default (yellow), Dark, Light, HighContrast, Subtle, SolarizedDark/Light
- Color validation and manipulation methods (Darken, Lighten)

### Extension Methods
- Viewport filtering: IsVisible, GetVisibleResults, GetResultsAboveCount/BelowCount
- Line indexing: GetMatchingLineIndices, GetMatchCountPerLine, GetResultsByLine
- Navigation helpers: FindNearestResultIndex, FindFirstResultAtOrAfter, FindLastResultAtOrBefore
- Range queries: GetResultsInRange, GetResultsOnLine, HasMatchOnLine
- Current result utilities: UpdateCurrentFlags, ClearCurrentFlags, GetCurrentIndex
- Position calculations: CalculateCenteredScrollPosition, GetRelativePosition

## Unit Tests

| Test File | Test Count |
|-----------|------------|
| TerminalSearchResultTests.cs | 31 |
| TerminalSearchStateTests.cs | 41 |
| TerminalSearchOptionsTests.cs | 19 |
| SearchHighlightStyleTests.cs | 22 |
| TerminalSearchExtensionsTests.cs | 28 |
| **Total** | **121** |

## File Manifest

### Created Files

```
src/AIntern.Core/Models/Terminal/
├── TerminalSearchResult.cs
├── TerminalSearchState.cs
├── TerminalSearchOptions.cs
├── SearchHighlightStyle.cs
├── SearchDirection.cs
└── TerminalSearchExtensions.cs

tests/AIntern.Core.Tests/Models/Terminal/
├── TerminalSearchResultTests.cs
├── TerminalSearchStateTests.cs
├── TerminalSearchOptionsTests.cs
├── SearchHighlightStyleTests.cs
└── TerminalSearchExtensionsTests.cs
```

## Dependencies

- **From v0.5.1**: TerminalBuffer (buffer to search within)
- **From v0.5.2**: Theme colors for highlighting integration

## Next Steps

- v0.5.5b: Terminal Search Service (search implementation, regex support)
- v0.5.5c: Terminal Search UI (search bar component, keyboard navigation)

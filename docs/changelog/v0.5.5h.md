# v0.5.5h - Status Bar Integration

**Released:** 2026-01-19

## Summary

Integrates terminal session information into the main window status bar, displaying active shell name, current working directory (with ~ abbreviation for home directory), and terminal count badge. The status bar section visibility is tied to the terminal panel visibility state.

## Features

### TerminalStatusBarViewModel

- **Session State Binding**: Subscribes to `TerminalPanelViewModel` for real-time session updates
- **Property Tracking**: Monitors `IsVisible`, `ActiveSession`, `HasActiveSession`, and `Sessions` collection
- **Active Session Monitoring**: Tracks `WorkingDirectory` and `State` changes on the active session
- **Path Abbreviation**: Replaces home directory with `~` for cleaner display
- **Shell Name Capitalization**: Capitalizes shell type for display (bash â†’ Bash)
- **Commands**: `ToggleTerminalPanel` delegates to terminal panel toggle
- **Event Cleanup**: Proper disposal unsubscribes from all events

### TerminalStatusBarSection.axaml

- **Horizontal Layout**: Vertical separator, toggle button, directory display, count badge
- **Terminal Toggle Button**: Icon + shell name, click toggles terminal panel
- **Directory Display**: Shows abbreviated path with tooltip showing full path
- **Count Badge**: Accent-colored badge showing terminal count (visible when > 1)
- **Visibility Binding**: Section visible only when terminal panel is visible

### Converters (Reused)

- **GreaterThanZeroConverter**: Reuses existing converter from v0.4.1h (`int > 0 â†’ bool`)
- **GreaterThanOneConverter**: Reuses existing converter from v0.4.1h (`int > 1 â†’ bool`)

## Files Changed

### New Files
| File | Description |
|------|-------------|
| `src/AIntern.Desktop/ViewModels/TerminalStatusBarViewModel.cs` | ViewModel with session state binding and path abbreviation |
| `src/AIntern.Desktop/Views/TerminalStatusBarSection.axaml` | Status bar section UserControl |
| `src/AIntern.Desktop/Views/TerminalStatusBarSection.axaml.cs` | Minimal code-behind |
| `tests/AIntern.Desktop.Tests/ViewModels/TerminalStatusBarViewModelTests.cs` | ViewModel unit tests (33 tests) |

### Modified Files
| File | Changes |
|------|---------|
| `src/AIntern.Desktop/Extensions/ServiceCollectionExtensions.cs` | Added singleton registration for TerminalStatusBarViewModel |
| `src/AIntern.Desktop/ViewModels/MainWindowViewModel.cs` | Added TerminalStatusBarViewModel property and initialization |
| `src/AIntern.Desktop/Views/MainWindow.axaml` | Replaced terminal button with TerminalStatusBarSection |

## API Reference

### TerminalStatusBarViewModel

```csharp
// Constructor
public TerminalStatusBarViewModel(
    ILogger<TerminalStatusBarViewModel> logger)

// Initialization
public void Initialize(TerminalPanelViewModel terminalPanelViewModel)

// Observable Properties
public bool IsVisible { get; }              // Bound to TerminalPanelViewModel.IsVisible
public bool HasActiveTerminal { get; }      // From TerminalPanelViewModel.HasActiveSession
public string ActiveShellName { get; }      // Capitalized shell type or "Terminal"
public string CurrentDirectory { get; }     // Raw working directory path
public string CurrentDirectoryDisplay { get; }  // Path with ~ abbreviation
public int TerminalCount { get; }           // From Sessions.Count

// Methods
public string AbbreviatePath(string? path)  // Replace home directory with ~

// Commands
public IRelayCommand ToggleTerminalPanelCommand { get; }

// IDisposable
public void Dispose()
```

### GreaterThanZeroConverter

```csharp
public class GreaterThanZeroConverter : IValueConverter
{
    public static readonly GreaterThanZeroConverter Instance;

    // int > 0 â†’ true, otherwise false
    public object? Convert(object? value, Type targetType, object? parameter, CultureInfo culture);

    // Not supported - throws NotSupportedException
    public object? ConvertBack(...);
}
```

### GreaterThanOneConverter

```csharp
public class GreaterThanOneConverter : IValueConverter
{
    public static readonly GreaterThanOneConverter Instance;

    // int > 1 â†’ true, otherwise false
    public object? Convert(object? value, Type targetType, object? parameter, CultureInfo culture);

    // Not supported - throws NotSupportedException
    public object? ConvertBack(...);
}
```

## Dependencies

- v0.5.5f: `TerminalPanelViewModel` for session state
- v0.5.2f: `TerminalSessionViewModel` for session properties
- v0.5.2d: Terminal infrastructure

## Testing

### TerminalStatusBarViewModelTests (25+ tests)

**Constructor Tests**
- `Constructor_NullLogger_ThrowsArgumentNullException`
- `Constructor_ValidDependencies_CreatesInstance`
- `Constructor_InitializesDefaultValues`

**Initialize Tests**
- `Initialize_NullTerminalPanelViewModel_ThrowsArgumentNullException`
- `Initialize_ValidTerminalPanel_Succeeds`
- `Initialize_SetsInitialIsVisible`
- `Initialize_SetsInitialTerminalCount`
- `Initialize_SetsInitialActiveSessionProperties`

**Property Update Tests**
- `IsVisible_UpdatesWhenTerminalPanelIsVisibleChanges`
- `HasActiveTerminal_TrueWhenActiveSessionExists`
- `HasActiveTerminal_FalseWhenNoActiveSession`
- `ActiveShellName_ReturnsShellTypeFromActiveSession`
- `ActiveShellName_ReturnsTerminalWhenNoActiveSession`
- `CurrentDirectory_UpdatesWhenActiveSessionChanges`
- `TerminalCount_UpdatesWhenSessionAdded`
- `TerminalCount_UpdatesWhenSessionRemoved`
- `PropertyChanged_RaisedForIsVisible`
- `ShellTypeCapitalization_WorksCorrectly`

**AbbreviatePath Tests**
- `AbbreviatePath_ReplacesHomeDirectoryWithTilde`
- `AbbreviatePath_PreservesNonHomePaths`
- `AbbreviatePath_HandlesNullInput`
- `AbbreviatePath_HandlesEmptyInput`
- `AbbreviatePath_HandlesExactHomeDirectory`
- `AbbreviatePath_HandlesHomeDirectoryWithTrailingSlash`
- `AbbreviatePath_IsCaseInsensitive`

**Command Tests**
- `ToggleTerminalPanelCommand_TogglesVisibility`
- `ToggleTerminalPanelCommand_WorksWithoutInitialization`

**Dispose Tests**
- `Dispose_UnsubscribesFromPropertyChanged`
- `Dispose_UnsubscribesFromCollectionChanged`
- `Dispose_CanBeCalledMultipleTimes`
- `Dispose_SafeWithoutInitialization`

**Active Session Subscription Tests**
- `ActiveSession_UpdatesDirectoryOnWorkingDirectoryChange`
- `ActiveSession_SwitchingUnsubscribesFromPrevious`

### GreaterThanZeroConverterTests (18 tests)

**Static Instance Tests**
- `Instance_IsNotNull`
- `Instance_IsSameInstance`

**Convert Tests**
- `Convert_PositiveInt_ReturnsTrue`
- `Convert_VariousPositiveInts_ReturnsTrue` (Theory: 1, 2, 10, 100, int.MaxValue)
- `Convert_Zero_ReturnsFalse`
- `Convert_NegativeInts_ReturnsFalse` (Theory: -1, -10, -100, int.MinValue)
- `Convert_NonInt_ReturnsFalse`
- `Convert_String_ReturnsFalse`
- `Convert_Double_ReturnsFalse`
- `Convert_Long_ReturnsFalse`
- `Convert_Null_ReturnsFalse`
- `Convert_IgnoresParameter`
- `Convert_IgnoresCulture`

**ConvertBack Tests**
- `ConvertBack_ThrowsNotSupportedException`
- `ConvertBack_ThrowsForFalseValue`
- `ConvertBack_ThrowsForNullValue`

### GreaterThanOneConverterTests (20 tests)

**Static Instance Tests**
- `Instance_IsNotNull`
- `Instance_IsSameInstance`

**Convert Tests**
- `Convert_IntGreaterThanOne_ReturnsTrue`
- `Convert_VariousValuesGreaterThanOne_ReturnsTrue` (Theory: 2, 3, 10, 100, int.MaxValue)
- `Convert_IntOne_ReturnsFalse`
- `Convert_IntZero_ReturnsFalse`
- `Convert_NegativeInts_ReturnsFalse` (Theory: -1, -10, -100, int.MinValue)
- `Convert_NonInt_ReturnsFalse`
- `Convert_String_ReturnsFalse`
- `Convert_Double_ReturnsFalse`
- `Convert_Long_ReturnsFalse`
- `Convert_Null_ReturnsFalse`
- `Convert_IgnoresParameter`
- `Convert_IgnoresCulture`
- `Convert_BoundaryValue_TwoReturnsTrue`
- `Convert_BoundaryValue_OneReturnsFalse`

**ConvertBack Tests**
- `ConvertBack_ThrowsNotSupportedException`
- `ConvertBack_ThrowsForFalseValue`
- `ConvertBack_ThrowsForNullValue`

## Acceptance Criteria

| ID | Criterion | Status |
|----|-----------|--------|
| AC-1 | Status bar section visible when terminal panel is visible | âœ“ |
| AC-2 | Status bar section hidden when terminal panel is hidden | âœ“ |
| AC-3 | Shell name displays active session shell type (capitalized) | âœ“ |
| AC-4 | Current directory displays with ~ abbreviation for home | âœ“ |
| AC-5 | Terminal count badge shows when > 1 terminal | âœ“ |
| AC-6 | Updates dynamically when active session changes | âœ“ |
| AC-7 | Updates when working directory changes | âœ“ |
| AC-8 | Click toggles terminal panel | âœ“ |
| AC-9 | All tests pass (60+) | âœ“ |
| AC-10 | Comprehensive XML documentation | âœ“ |
| AC-11 | Changelog entries created | âœ“ |

## Breaking Changes

None.

## UI Preview

```
Status Bar Layout:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Model Name â”‚ | ðŸ–¥ï¸ Bash â”‚ ~/Projects/app â”‚ [2] â”‚ Preset: ... â”‚ T:0.70 â”‚ ... â”‚
â”‚            â”‚ â†‘          â†‘                  â†‘                                   â”‚
â”‚            â”‚ â”‚          â”‚                  â””â”€â”€ Count badge (> 1)              â”‚
â”‚            â”‚ â”‚          â””â”€â”€ Directory with ~ abbreviation                     â”‚
â”‚            â”‚ â””â”€â”€ Vertical separator + shell icon + name                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Path Abbreviation Examples

| Original Path | Abbreviated |
|--------------|-------------|
| `/Users/ryan/Projects/app` | `~/Projects/app` |
| `/home/user/code` | `~/code` |
| `C:\Users\Admin\Documents` | `~\Documents` |
| `/var/log` | `/var/log` |
| `/Users/ryan` | `~` |
| `null` or empty | (empty string) |

# v0.4.3a: Core Models

**Release Date:** January 16, 2026  
**Type:** Feature (Apply Changes Workflow)  
**Parent:** v0.4.3 Apply Changes Workflow

---

## Overview

v0.4.3a establishes the foundational models for the Apply Changes Workflow, defining data structures for apply operations, results, change tracking, conflict detection, and events.

---

## New Files

| File | Purpose |
|------|---------|
| `Models/ApplyOptions.cs` | Configuration record with presets and builder methods |
| `Models/ApplyResult.cs` | Apply operation result with factory methods |
| `Models/ApplyResultType.cs` | Enum for result categorization (success/failure) |
| `Models/FileChangeRecord.cs` | Undo tracking and change history |
| `Models/FileChangeType.cs` | Enum for file modification types |
| `Models/LineEndingStyle.cs` | Enum for line ending detection |
| `Models/ApplyPreview.cs` | Pre-apply preview and conflict check |
| `Models/ApplyEventArgs.cs` | Event arguments for apply notifications |

---

## Key Components

### ApplyOptions
Configuration record with:
- Backup, conflict, undo, dialog options
- File handling settings (encoding, line endings)
- Static presets: `Default`, `Silent`, `Batch`, `ExtendedUndo`
- Builder methods: `WithoutBackup()`, `WithUndoWindow()`, `WithConflictOverwrite()`

### ApplyResult
Result class with:
- Success/failure state and result type
- File paths, backup path, line statistics
- Undo information (ChangeRecordId, UndoExpiresAt)
- Factory methods: `Modified()`, `Created()`, `Failed()`, `Conflict()`, `Cancelled()`

### FileChangeRecord
Change tracking with:
- Unique ID, file paths, timestamps
- Content hashes for conflict detection
- Undo state and time calculations
- Methods: `CanUndo()`, `GetUndoTimeRemaining()`, `IsUndoExpired()`

### Event Args
- `FileChangedEventArgs` - File change notification
- `FileChangeFailedEventArgs` - Failure notification
- `FileChangeUndoneEventArgs` - Undo notification
- `FileConflictDetectedEventArgs` - Conflict notification

---

## Tests

- 41 new unit tests in `ApplyModelsTests.cs`
- Tests cover: ApplyOptions, ApplyResultType, ApplyResult, FileChangeRecord, LineEndingStyle, ConflictCheckResult

---

## Verification

- ✅ Build succeeds (0 errors)
- ✅ 41 tests pass

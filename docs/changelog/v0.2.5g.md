# v0.2.5g - Status Bar & Shortcuts

**Release Date:** 2026-01-14
**Type:** Feature (UI Layer)
**Status:** Complete

## Overview

This release enhances the status bar with interactive elements and color-coded save state indicators. The feature adds clickable model name and temperature controls, live save status with color feedback (Saved/Unsaved/Saving), and new global keyboard shortcuts.

**Building on:** v0.2.5f (Export UI)
**Design Reference:** [v0.2.5g-status-bar-shortcuts.md](../design/v0.2.x/v0.2.5g-status-bar-shortcuts.md)

## Architecture

```
+------------------------------------------------------------------+
|                   v0.2.5g Status Bar & Shortcuts                  |
+------------------------------------------------------------------+
|                                                                    |
|  Enhanced Status Bar Layout:                                       |
|  ┌──────────────────────────────────────────────────────────────┐  |
|  │ [Model Name]  | Preset | [Temp] | SaveStatus | Tokens | Prog │  |
|  │  (clickable)  |        |(click) | (colored)  |        |      │  |
|  │  (colored)    |        |        |            |        |      │  |
|  └──────────────────────────────────────────────────────────────┘  |
|                                                                    |
|  Color Scheme:                                                     |
|  ├── Model Name: Accent (#00d9ff) when loaded, Muted (#888888)     |
|  ├── Save Status: Green (#4caf50) saved, Yellow (#ffc107) unsaved  |
|  └──               Accent (#00d9ff) saving                         |
|                                                                    |
|  New Converters:                                                   |
|  ├── BoolToAccentColorConverter: bool → IBrush (accent/muted)      |
|  ├── SaveStatusTextConverter: SaveState → "Saving..."/"Unsaved"/"" |
|  └── SaveStatusColorConverter: SaveState → IBrush (color coded)    |
|                                                                    |
|  New Keyboard Shortcuts:                                           |
|  ├── Ctrl+, → ToggleSettingsPanelCommand (opens inference panel)   |
|  ├── Ctrl+P → OpenSystemPromptEditorCommand (existing)             |
|  └── Ctrl+Shift+S → SaveCommand (force save)                       |
|                                                                    |
|  Existing Shortcuts:                                               |
|  ├── Ctrl+K → OpenSearchCommand ✓                                  |
|  ├── Ctrl+N → NewConversationCommand ✓                             |
|  ├── Ctrl+E → OpenExportCommand ✓                                  |
|  ├── Ctrl+S → ChatViewModel.SaveCommand ✓                          |
|  ├── Ctrl+B → ToggleSidebarCommand ✓                               |
|  └── Ctrl+F → FocusSearchCommand ✓                                 |
|                                                                    |
+------------------------------------------------------------------+
```

## Key Features

### 1. Clickable Model Name

The model name in the status bar is now a clickable button that:
- Shows accent color (#00d9ff) when a model is loaded
- Shows muted color (#888888) when no model is loaded
- Opens the sidebar (same as Ctrl+B) when clicked
- Displays tooltip "Click to open model selector (Ctrl+B)"

### 2. Color-Coded Save Status

The save status indicator now shows:
- **"Saved"** in green (#4caf50) when all changes are saved
- **"Unsaved"** in yellow (#ffc107) when there are unsaved changes
- **"Saving..."** in accent (#00d9ff) when a save is in progress

### 3. Clickable Temperature

The temperature display (T:0.70) is now a clickable button that:
- Expands/collapses the inference settings panel
- Shows sidebar if hidden when expanding settings
- Displays tooltip "Click to open settings (Ctrl+,)"

### 4. New Keyboard Shortcuts

| Shortcut | Command | Description |
|----------|---------|-------------|
| Ctrl+, | ToggleSettingsPanelCommand | Opens/closes inference settings |
| Ctrl+P | OpenSystemPromptEditorCommand | Opens system prompt editor |
| Ctrl+Shift+S | SaveCommand | Forces save of current conversation |

## Files Created

### 1. BoolToAccentColorConverter.cs

**Path:** `src/AIntern.Desktop/Converters/BoolToAccentColorConverter.cs`
**Lines:** ~105

Value converter for model name color based on load state.

#### Conversion Logic

| Input | Output |
|-------|--------|
| `true` | Accent brush (#00d9ff) |
| `false` | Muted brush (#888888) |
| `null` | Muted brush (default) |
| non-bool | Muted brush (fallback) |

#### Key Features

| Feature | Description |
|---------|-------------|
| Singleton Pattern | `Instance` property for reuse |
| Static brushes | Cached IBrush instances |
| Full documentation | XML docs with color rationale |
| One-way only | ConvertBack throws NotSupportedException |

### 2. SaveStatusConverter.cs

**Path:** `src/AIntern.Desktop/Converters/SaveStatusConverter.cs`
**Lines:** ~230

Contains two converters for save status display.

#### SaveStatusTextConverter

| Input State | Output Text |
|-------------|-------------|
| IsSaving = true | "Saving..." |
| HasUnsavedChanges = true | "Unsaved" |
| Both false | "Saved" |
| null / invalid | "Saved" (default) |

#### SaveStatusColorConverter

| Input State | Output Color |
|-------------|--------------|
| IsSaving = true | Accent (#00d9ff) |
| HasUnsavedChanges = true | Yellow (#ffc107) |
| Both false | Green (#4caf50) |
| null / invalid | Green (default) |

### 3. SaveStatusConverterTests.cs

**Path:** `tests/AIntern.Desktop.Tests/Converters/SaveStatusConverterTests.cs`
**Lines:** ~400

Unit tests for all three new converters.

#### Test Categories

| Converter | Test Count | Description |
|-----------|------------|-------------|
| SaveStatusTextConverter | 8 | All states, null, invalid |
| SaveStatusColorConverter | 8 | All states, null, invalid |
| BoolToAccentColorConverter | 8 | true/false, null, invalid |
| **Total** | **24** | |

## Files Modified

### 1. MainWindowViewModel.cs

**Path:** `src/AIntern.Desktop/ViewModels/MainWindowViewModel.cs`
**Lines Added:** ~80

Added save state tracking and settings toggle:

```csharp
// New observable properties
[ObservableProperty]
private SaveStateChangedEventArgs? _saveState;

[ObservableProperty]
private bool _isModelLoaded;

// Constructor additions
_conversationService.SaveStateChanged += OnSaveStateChanged;
IsModelLoaded = _llmService.IsModelLoaded;

// New event handler
private void OnSaveStateChanged(object? sender, SaveStateChangedEventArgs e)
{
    SaveState = e;
}

// New command
[RelayCommand]
private void ToggleSettingsPanel()
{
    InferenceSettingsViewModel.IsExpanded = !InferenceSettingsViewModel.IsExpanded;
    if (InferenceSettingsViewModel.IsExpanded && !IsSidebarVisible)
        IsSidebarVisible = true;
}
```

### 2. MainWindow.axaml

**Path:** `src/AIntern.Desktop/Views/MainWindow.axaml`
**Lines Changed:** ~70

Updated keyboard shortcuts and status bar:

#### New Keyboard Shortcuts

```xml
<Window.KeyBindings>
    <!-- Existing bindings... -->
    <!-- Ctrl+,: Toggle inference settings panel (v0.2.5g) -->
    <KeyBinding Gesture="Ctrl+OemComma" Command="{Binding ToggleSettingsPanelCommand}" />
    <!-- Ctrl+P: Open system prompt editor (v0.2.5g) -->
    <KeyBinding Gesture="Ctrl+P" Command="{Binding OpenSystemPromptEditorCommand}" />
    <!-- Ctrl+Shift+S: Force save (v0.2.5g) -->
    <KeyBinding Gesture="Ctrl+Shift+S" Command="{Binding ChatViewModel.SaveCommand}" />
</Window.KeyBindings>
```

#### Enhanced Status Bar

```xml
<!-- Model Name (clickable, color-coded) -->
<Button Command="{Binding ToggleSidebarCommand}"
        Background="Transparent" BorderThickness="0">
    <TextBlock Text="{Binding StatusMessage}"
               Foreground="{Binding IsModelLoaded,
                   Converter={x:Static converters:BoolToAccentColorConverter.Instance}}" />
</Button>

<!-- Temperature (clickable) -->
<Button Command="{Binding ToggleSettingsPanelCommand}"
        Background="Transparent" BorderThickness="0">
    <TextBlock Text="{Binding InferenceSettingsViewModel.Temperature, StringFormat='T:{0:F2}'}" />
</Button>

<!-- Save Status (color-coded) -->
<TextBlock Text="{Binding SaveState,
               Converter={x:Static converters:SaveStatusTextConverter.Instance}}"
           Foreground="{Binding SaveState,
               Converter={x:Static converters:SaveStatusColorConverter.Instance}}" />
```

### 3. MainWindowViewModelTests.cs

**Path:** `tests/AIntern.Desktop.Tests/ViewModels/MainWindowViewModelTests.cs`
**Lines Added:** ~150

Added tests for v0.2.5g functionality:

#### New Test Categories

| Category | Test Count | Description |
|----------|------------|-------------|
| SaveStateChanged subscription | 1 | Event subscription verified |
| SaveState default | 1 | Null by default |
| IsModelLoaded default | 2 | False/true based on service |
| SaveStateChanged handler | 3 | Updates SaveState property |
| ModelStateChanged IsModelLoaded | 2 | Updates on model load/unload |
| Property notifications | 2 | PropertyChanged events |
| ToggleSettingsPanel | 3 | Toggle behavior, sidebar |
| **Total** | **14** | |

### 4. CHANGELOG.md

**Path:** `CHANGELOG.md`
**Lines Added:** ~25

Added v0.2.5g entry at top.

## Logging Specifications

All methods use exhaustive logging with Stopwatch timing:

| Marker | Level | Usage |
|--------|-------|-------|
| `[ENTER]` | Debug | Method entry with parameters |
| `[INFO]` | Debug/Info | Significant state/action |
| `[EVENT]` | Debug | Event handler invocation |
| `[EXIT]` | Debug | Method completion with duration |

### Example Log Output

```
[DEBUG] [EVENT] OnSaveStateChanged - IsSaving: true, HasUnsavedChanges: false
[DEBUG] [INFO] Save state updated
[DEBUG] [ENTER] ToggleSettingsPanel - Current: false
[DEBUG] [INFO] Sidebar opened to show settings panel
[INFO] [INFO] Settings panel toggled to: true
[DEBUG] [EXIT] ToggleSettingsPanel - 2ms
[DEBUG] [EVENT] OnModelStateChanged - IsLoaded: true, ModelName: my-model
[INFO] [INFO] Status updated: Model: my-model
```

## Usage Examples

### Opening Settings via Keyboard

Press `Ctrl+,` to toggle the inference settings panel expansion state.

### Clicking Model Name

Click the model name in the status bar to open/close the sidebar containing the model selector.

### Save Status Indicators

| Display | Meaning | Color |
|---------|---------|-------|
| "Saved" | All changes saved | Green |
| "Unsaved" | Pending changes | Yellow |
| "Saving..." | Save in progress | Accent |

### Temperature Quick Access

Click the temperature display (e.g., "T:0.70") in the status bar to expand the inference settings panel. If the sidebar is hidden, it will be automatically shown.

## Design Decisions

| Decision | Rationale |
|----------|-----------|
| **Clickable status bar elements** | Discoverability and quick access |
| **Color-coded save status** | Visual feedback without reading text |
| **Priority order in converters** | IsSaving > HasUnsavedChanges > Saved |
| **Sidebar auto-show** | Settings panel lives in sidebar |
| **Static brushes** | Avoid allocation on every conversion |
| **Singleton converters** | Standard pattern, memory efficient |
| **Ctrl+, for settings** | Matches VS Code and other editors |

## Acceptance Criteria

| ID | Criterion | Status |
|----|-----------|--------|
| AC-1 | Model name clickable and shows sidebar | ✅ |
| AC-2 | Model name color changes based on load state | ✅ |
| AC-3 | Save status shows correct text (Saved/Unsaved/Saving) | ✅ |
| AC-4 | Save status shows correct color | ✅ |
| AC-5 | Temperature clickable and expands settings | ✅ |
| AC-6 | Ctrl+, opens/expands inference settings | ✅ |
| AC-7 | Ctrl+P opens system prompt editor | ✅ |
| AC-8 | Ctrl+Shift+S forces save | ✅ |
| AC-9 | Converters have comprehensive XML documentation | ✅ |
| AC-10 | Exhaustive logging with timing | ✅ |
| AC-11 | 38 new unit tests pass (24 converter + 14 ViewModel) | ✅ |
| AC-12 | Build passes with 0 errors, 0 warnings | ✅ |

## Dependencies

### Required (Already Implemented)

| Component | Version | Purpose |
|-----------|---------|---------|
| SaveStateChangedEventArgs | v0.2.x | Save state event data |
| IConversationService | v0.2.x | SaveStateChanged event source |
| ILlmService | v0.2.x | ModelStateChanged event, IsModelLoaded |
| InferenceSettingsViewModel | v0.2.3e | Settings panel with IsExpanded |
| MainWindowViewModel | v0.2.x | Status bar state management |

### Downstream (Future)

| Component | Version | Description |
|-----------|---------|-------------|
| Status bar themes | Future | Theme-aware colors |
| Additional shortcuts | Future | More keyboard accessibility |

## Files Summary

| File | Action | Lines |
|------|--------|-------|
| `src/AIntern.Desktop/Converters/BoolToAccentColorConverter.cs` | Create | ~105 |
| `src/AIntern.Desktop/Converters/SaveStatusConverter.cs` | Create | ~230 |
| `tests/AIntern.Desktop.Tests/Converters/SaveStatusConverterTests.cs` | Create | ~400 |
| `docs/changelog/v0.2.5g.md` | Create | ~350 |
| `src/AIntern.Desktop/ViewModels/MainWindowViewModel.cs` | Modify | +80 |
| `src/AIntern.Desktop/Views/MainWindow.axaml` | Modify | +70 |
| `tests/AIntern.Desktop.Tests/ViewModels/MainWindowViewModelTests.cs` | Modify | +150 |
| `CHANGELOG.md` | Modify | +25 |
| **Total** | | **~1,410** |

## Next Steps

| Version | Description |
|---------|-------------|
| v0.2.6 | Additional features TBD |

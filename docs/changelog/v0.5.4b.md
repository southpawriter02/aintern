# v0.5.4b: Command Extractor Service

**Date**: 2026-01-18

Implements the command extraction service for parsing executable commands from AI-generated markdown.

## Added

### Interface
- **`ICommandExtractorService`** with 5 methods:
  - `ExtractCommands(content, messageId)` - Main extraction pipeline
  - `IsShellCommand(language, content)` - Shell command detection
  - `GetShellTypeForLanguage(language)` - Language to ShellType mapping
  - `CheckCommandSafety(command)` - Dangerous pattern detection
  - `ExtractDescription(content, position)` - Context extraction

### Implementation
- **`CommandExtractorService`** with:
  - **Shell Languages**: 18 identifiers (bash, sh, zsh, fish, powershell, pwsh, cmd, etc.)
  - **Common Commands**: 70+ executables for heuristic detection
  - **Dangerous Patterns**: 12 source-generated regex patterns
  - **Indicator Phrases**: 14 phrases for inline detection
  - **Confidence Scoring**: 0.40-0.95 based on extraction method

### Dangerous Patterns Detected
| Pattern | Warning |
|---------|---------|
| `rm -rf /` | Recursive deletion |
| `sudo rm` | Elevated deletion |
| `dd of=` | Disk overwrite |
| `DROP DATABASE` | Database deletion |
| `curl \| sh` | Piped scripts |
| Fork bombs | Do NOT run |
| `format [drive]:` | Disk format |
| `mkfs.*` | Filesystem creation |
| `killall/pkill` | Process termination |
| `reboot/shutdown` | System restart |
| `chmod -R` | Recursive permissions |
| `truncate` | File emptying |

### Shell Type Inference
- Detects PowerShell from `$env:`, `Get-`, `Set-` patterns
- Detects CMD from `%VAR%` syntax
- Detects Fish from `set` without `=`

## Testing
- 61 new tests in `CommandExtractorServiceTests.cs`
- All tests pass (100% pass rate)

## Files Changed

| File | Status |
|------|--------|
| `src/AIntern.Core/Interfaces/ICommandExtractorService.cs` | Added |
| `src/AIntern.Services/Terminal/CommandExtractorService.cs` | Added |
| `src/AIntern.Services/Terminal/TerminalServiceExtensions.cs` | Modified |
| `tests/AIntern.Services.Tests/Terminal/CommandExtractorServiceTests.cs` | Added |

## Dependencies
- Uses v0.5.4a models: `CommandBlock`, `CommandExtractionResult`, `TextRange`
- Uses v0.5.3a: `ShellType` enum

## Next Steps
- **v0.5.4c**: Command UI components for rendering extracted commands
